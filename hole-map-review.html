<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Revision de Hoyos</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <style>
      :root {
        --bg: #e9f5ff;
        --panel: rgba(255, 255, 255, 0.96);
        --line: rgba(17, 63, 97, 0.12);
        --ink: #163149;
        --muted: #65839b;
        --accent: #1177b9;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: Arial, sans-serif;
        color: var(--ink);
        background: linear-gradient(180deg, #dff1ff, #eef8ff);
      }

      .layout {
        display: grid;
        grid-template-columns: 320px 1fr;
        min-height: 100vh;
      }

      .sidebar {
        padding: 16px;
        border-right: 1px solid var(--line);
        background: var(--panel);
        overflow-y: auto;
      }

      .sidebar h1 {
        margin: 0 0 6px;
        font-size: 1.15rem;
      }

      .sidebar p {
        margin: 0 0 14px;
        color: var(--muted);
        font-size: 0.9rem;
        line-height: 1.4;
      }

      .toolbar {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
      }

      .toolbar button {
        flex: 1;
        min-height: 36px;
        border: 0;
        border-radius: 10px;
        font-weight: 700;
        cursor: pointer;
        background: #dff1ff;
        color: var(--accent);
      }

      .course-list {
        display: grid;
        gap: 8px;
      }

      .course-item {
        display: grid;
        gap: 4px;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--line);
        background: #fff;
      }

      .course-item label {
        display: flex;
        gap: 8px;
        align-items: center;
        font-weight: 700;
      }

      .course-meta {
        font-size: 0.78rem;
        color: var(--muted);
      }

      .swatch {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
      }

      #map {
        width: 100%;
        height: 100vh;
      }

      .leaflet-popup-content {
        line-height: 1.35;
      }

      @media (max-width: 900px) {
        .layout {
          grid-template-columns: 1fr;
          grid-template-rows: auto 70vh;
        }

        .sidebar {
          border-right: 0;
          border-bottom: 1px solid var(--line);
        }

        #map {
          height: 70vh;
        }
      }
    </style>
  </head>
  <body>
    <div class="layout">
      <aside class="sidebar">
        <h1>Mapa de Revision de Hoyos</h1>
        <p>
          Este visor usa las coordenadas de green que ya estan cargadas en el proyecto. Puedes activar o desactivar
          campos para ver si algun hoyo esta fuera de sitio.
        </p>
        <div class="toolbar">
          <button type="button" id="show-all">Mostrar todo</button>
          <button type="button" id="hide-all">Ocultar todo</button>
        </div>
        <div id="course-list" class="course-list"></div>
      </aside>
      <main id="map"></main>
    </div>

    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script>
      const courseNames = {
        "abama-golf": "Abama Golf",
        "amarilla-golf": "Amarilla Golf",
        "golf-costa-adeje": "Golf Costa Adeje",
        "buenavista-golf": "Buenavista Golf",
        "golf-del-sur": "Golf del Sur",
        "golf-las-americas": "Golf Las Americas",
        "golf-los-palos": "Golf Los Palos",
      };
      const colors = ["#1177b9", "#2d7f2f", "#cf3b2c", "#7a52c7", "#d48b19", "#0f8f8f", "#c2185b"];
      const map = L.map("map", { zoomControl: true }).setView([28.13, -16.69], 10);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "&copy; OpenStreetMap",
      }).addTo(map);

      const layersByCourse = new Map();
      const list = document.querySelector("#course-list");

      function buildPopup(course, hole) {
        return `
          <strong>${courseNames[course.id] || course.id}</strong><br />
          Hoyo ${hole.number} · Par ${hole.par} · HCP ${hole.strokeIndex}<br />
          ${course.tee} · ${hole.meters} m<br />
          ${hole.lat.toFixed(6)}, ${hole.lng.toFixed(6)}
        `;
      }

      courses.forEach((course, index) => {
        const color = colors[index % colors.length];
        const group = L.layerGroup();
        const line = L.polyline(
          course.holes.map((hole) => [hole.lat, hole.lng]),
          { color, weight: 2.5, opacity: 0.75 }
        );
        line.addTo(group);

        course.holes.forEach((hole) => {
          const marker = L.circleMarker([hole.lat, hole.lng], {
            radius: 6,
            color,
            weight: 2,
            fillColor: "#ffffff",
            fillOpacity: 0.95,
          });
          marker.bindPopup(buildPopup(course, hole));
          marker.bindTooltip(`${courseNames[course.id] || course.id} · H${hole.number}`, { direction: "top" });
          marker.addTo(group);
        });

        layersByCourse.set(course.id, group);
        group.addTo(map);

        const item = document.createElement("div");
        item.className = "course-item";
        item.innerHTML = `
          <label>
            <input type="checkbox" data-course-id="${course.id}" checked />
            <span class="swatch" style="background:${color}"></span>
            <span>${courseNames[course.id] || course.id}</span>
          </label>
          <div class="course-meta">${course.tee} · ${course.holes.length} hoyos con coordenadas</div>
        `;
        list.appendChild(item);
      });

      function updateBounds() {
        const latLngs = [];
        layersByCourse.forEach((group, id) => {
          if (!map.hasLayer(group)) {
            return;
          }
          group.eachLayer((layer) => {
            if (typeof layer.getLatLng === "function") {
              latLngs.push(layer.getLatLng());
            }
          });
        });
        if (latLngs.length) {
          map.fitBounds(L.latLngBounds(latLngs), { padding: [24, 24] });
        }
      }

      list.addEventListener("change", (event) => {
        const checkbox = event.target.closest("input[type='checkbox']");
        if (!checkbox) {
          return;
        }
        const group = layersByCourse.get(checkbox.dataset.courseId);
        if (!group) {
          return;
        }
        if (checkbox.checked) {
          group.addTo(map);
        } else {
          map.removeLayer(group);
        }
        updateBounds();
      });

      document.querySelector("#show-all").addEventListener("click", () => {
        document.querySelectorAll("input[data-course-id]").forEach((checkbox) => {
          checkbox.checked = true;
          const group = layersByCourse.get(checkbox.dataset.courseId);
          if (group && !map.hasLayer(group)) {
            group.addTo(map);
          }
        });
        updateBounds();
      });

      document.querySelector("#hide-all").addEventListener("click", () => {
        document.querySelectorAll("input[data-course-id]").forEach((checkbox) => {
          checkbox.checked = false;
          const group = layersByCourse.get(checkbox.dataset.courseId);
          if (group && map.hasLayer(group)) {
            map.removeLayer(group);
          }
        });
      });

      updateBounds();
    </script>
  </body>
</html>
